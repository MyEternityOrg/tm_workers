{% extends 'extworkers/base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" type="text/css" media="screen"
          href="{% static 'dist/css/bootstrap-datetimepicker.min.css' %}">
    <link href="{% static 'dist/css/bootstrap-combined.min.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <main>
        <div class="container-fluid">
            <h5 class="mt-4">Добавление сотрудника: </h5>
            <form action="#" method="post" enctype="multipart/form-data" id="f_main">
                {% csrf_token %}
                <div class="form-row">
                    <div class="col-lg-6">
                        <div class="form-group">
                            <label class="small mb-1" for="{{ form.person_name.id_for_label }}">Сотрудник: </label>
                            {{ form.person_name }}
                        </div>
                    </div>
                    <label class="small mb-1" for="{{ form.f_time.id_for_label }}">Время начала работы: </label>
                    <div id="f_time_picker" class="input-append">
                        {{ form.f_time }}
                        <span class="add-on">
                            <i style="width: 14px; height: 14px; margin-top: -3px" data-time-icon="icon-time"
                               data-date-icon="icon-calendar"></i>
                        </span>
                    </div>
                    <label class="small mb-1" for="{{ form.t_time.id_for_label }}">Время окончания работы: </label>
                    <div id="t_time_picker" class="input-append">
                        {{ form.t_time }}
                        <span class="add-on">
                            <i style="width: 14px; height: 14px; margin-top: -3px" data-time-icon="icon-time"
                               data-date-icon="icon-calendar"></i>
                        </span>
                    </div>
                </div>
                <span id="result"></span>
                <div class="form-row">
                    <div class="col-lg-12" style="margin-top: 33px;">
                        <input class="btn btn-info btn-block" type="submit" value="Сохранить">
                    </div>
                </div>
            </form>
        </div>
    </main>
{% endblock %}

{% block script %}
    <script src="{% static 'dist/js/bootstrap-datetimepicker.min.js' %}"></script>
    <script type="text/javascript">
        const f_time = document.getElementById('id_f_time');
        const t_time = document.getElementById('id_t_time');
        const f_main = document.getElementById('f_main')
        {# setting up time fields styles#}

        $(function () {
            $('#f_time_picker').datetimepicker({
                pickDate: false,
                pickSeconds: false
            });
        });

        $(function () {
            $('#t_time_picker').datetimepicker({
                pickDate: false,
                pickSeconds: false
            });
        });

        {# default time values #}
        document.addEventListener('DOMContentLoaded', function (event) {
            f_time.value = '09:00';
            t_time.value = '17:00';
        });

        {# before submit validation #}
        document.addEventListener('submit', function (e) {
            let fd = new Date()
            let td = new Date()
            fd.setHours.apply(fd, f_time.value.split(":"));
            td.setHours.apply(td, t_time.value.split(":"));
            if (fd >= td) {
                result.innerHTML = '<p><div class="alert alert-danger" role="alert">Введен некоррекнтый интервал! Проверьте что время начала работы не больше времени завершения!</div></p>'
                e.preventDefault();
            }
        });
    </script>
{% endblock %}